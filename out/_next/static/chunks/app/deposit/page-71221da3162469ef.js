(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[449,12,676,933],{2290:function(e,t,n){Promise.resolve().then(n.bind(n,7573))},7573:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return d}});var r=n(7437),a=n(2265),o=n(9376),i=n(1676),s=n(1933),l=n(1012),c=n(5765),u=n(257);function d(){var e;let[t,n]=(0,a.useState)("ethereum"),[d,m]=(0,a.useState)("ETH"),[f,g]=(0,a.useState)(""),[h,p]=(0,a.useState)("pending"),[b,w]=(0,a.useState)("idle"),[x,y]=(0,a.useState)("idle"),[v,S]=(0,a.useState)(null),[N,T]=(0,a.useState)(null),j=(0,o.useRouter)(),k=async()=>{try{p("pending");let t=await (0,l.tC)();if(!t.address){alert("Please connect your wallet first"),p("pending");return}let n=await (0,s.screenAddress)(t.address);if(n.ok)p("pass");else{var e;p("fail"),alert("Screening failed: ".concat((null===(e=n.reasons)||void 0===e?void 0:e.join(", "))||"Address flagged"))}}catch(e){console.error("Screening error:",e),p("fail"),alert("Screening failed. Please try again.")}},C=async()=>{if(f&&"pass"===h)try{w("generating");let e=await (0,l.tC)();if(!e.address){alert("Please connect your wallet first"),w("idle");return}let n=(0,i.hz)(f);if(!n.isValid){alert(n.error),w("idle");return}let r=(0,i.ax)(d,t);if(!r.isValid){alert(r.error),w("idle");return}let a={assetSymbol:d,amount:f,senderAddress:e.address,nonce:Date.now().toString()},o=await (0,s.nH)(a);sessionStorage.setItem("lastProof",JSON.stringify(o)),w("complete");let u=(0,c.UK)({asset:d,denomination:f});T(u.note),(0,c.ze)(u)}catch(e){console.error("Proof generation error:",e),alert("Failed to generate proof"),w("idle")}},E=async()=>{if("complete"===b)try{let e=await (0,l.tC)();if(!e.address){alert("Please connect your wallet first");return}let n=sessionStorage.getItem("lastProof");if(!n){alert("Proof not found. Please generate proof first.");return}let r=JSON.parse(n),a=await (0,s.BB)({network:t,assetSymbol:d,amount:f,address:e.address,proof:r}),o=u.env.NEXT_PUBLIC_CONTRACT_ADDRESS||"0x0000000000000000000000000000000000000000";if(!a||"0x"===a){alert("Transaction calldata not available. Contract may not be deployed.");return}y("signing");let i=BigInt(Math.floor(1e18*parseFloat(f))).toString(),m=await (0,s.Lg)({network:t,to:o,data:a,value:"ETH"===d||"MATIC"===d?i:void 0});S(m),y("pending");try{await (0,l.ec)(m,12e4),y("success"),(0,c.NO)({type:"deposit",asset:d,amount:f,network:t,hash:m,timestamp:new Date().toISOString()}),setTimeout(()=>{j.push("/dashboard")},2e3)}catch(e){console.error("Receipt error:",e),y("pending")}}catch(e){console.error("Submit error:",e),y("error"),alert("Transaction failed: ".concat(e instanceof Error?e.message:"Unknown error")),setTimeout(()=>{y("idle")},3e3)}};return(0,r.jsx)("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 py-12",children:(0,r.jsx)("div",{className:"max-w-2xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,r.jsxs)("div",{className:"bg-white dark:bg-gray-800 shadow rounded-lg p-8",children:[(0,r.jsx)("h1",{className:"text-3xl font-bold mb-6",children:"Deposit"}),N&&(0,r.jsxs)("div",{className:"mb-6 p-3 rounded bg-yellow-50 dark:bg-yellow-900/20 text-sm",children:[(0,r.jsx)("div",{className:"font-medium mb-2",children:"Deposit Note"}),(0,r.jsx)("div",{className:"break-all mb-2",children:N}),(0,r.jsx)("button",{className:"px-3 py-2 rounded bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600",onClick:()=>{let e=new Blob([N],{type:"text/plain;charset=utf-8"}),t=URL.createObjectURL(e),n=document.createElement("a");n.href=t,n.download="deposit-note-".concat(Date.now(),".txt"),n.click(),URL.revokeObjectURL(t)},children:"Download Note"})]}),(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Network"}),(0,r.jsx)("div",{className:"grid grid-cols-2 gap-3",children:[{id:"ethereum",name:"Ethereum",chainId:1},{id:"polygon",name:"Polygon",chainId:137},{id:"arbitrum",name:"Arbitrum",chainId:42161},{id:"optimism",name:"Optimism",chainId:10}].map(e=>(0,r.jsx)("button",{onClick:()=>n(e.id),className:"px-4 py-3 rounded-lg border transition ".concat(t===e.id?"border-blue-600 bg-blue-50 dark:bg-blue-900/20":"border-gray-300 dark:border-gray-600 hover:border-gray-400"),children:e.name},e.id))})]}),(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Asset"}),(0,r.jsx)("select",{value:d,onChange:e=>m(e.target.value),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white",children:null===(e=({ethereum:["ETH","USDC","USDT"],polygon:["MATIC","USDC","USDT"],arbitrum:["ETH","USDC","USDT"],optimism:["ETH","USDC","USDT"]})[t])||void 0===e?void 0:e.map(e=>(0,r.jsx)("option",{value:e,children:e},e))})]}),(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Amount"}),(0,r.jsx)("input",{type:"text",value:f,onChange:e=>g(e.target.value),placeholder:"0.0",className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white"})]}),(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,r.jsx)("label",{className:"block text-sm font-medium",children:"Address Screening"}),"pass"===h&&(0,r.jsx)("span",{className:"text-green-600 text-sm",children:"✓ Passed"}),"fail"===h&&(0,r.jsx)("span",{className:"text-red-600 text-sm",children:"✗ Failed"})]}),(0,r.jsx)("button",{onClick:k,disabled:"pass"===h,className:"w-full bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white font-medium py-2 px-4 rounded-lg transition",children:"Run Screening"})]}),(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,r.jsx)("label",{className:"block text-sm font-medium",children:"ZK Proof Generation"}),"complete"===b&&(0,r.jsx)("span",{className:"text-green-600 text-sm",children:"✓ Complete"}),"generating"===b&&(0,r.jsx)("span",{className:"text-blue-600 text-sm",children:"Generating..."})]}),(0,r.jsx)("button",{onClick:C,disabled:"pass"!==h||!f||"generating"===b||"complete"===b,className:"w-full bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white font-medium py-2 px-4 rounded-lg transition",children:"Generate Proof"})]}),"idle"!==x&&(0,r.jsxs)("div",{className:"mb-6 p-4 rounded-lg bg-gray-50 dark:bg-gray-700",children:["signing"===x&&(0,r.jsx)("p",{className:"text-blue-600",children:"Please sign the transaction in your wallet..."}),"pending"===x&&(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-yellow-600 mb-2",children:"Transaction submitted. Waiting for confirmation..."}),v&&(0,r.jsxs)("p",{className:"text-sm text-gray-600 dark:text-gray-400 break-all",children:["Hash: ",v]})]}),"success"===x&&(0,r.jsx)("p",{className:"text-green-600",children:"✓ Transaction confirmed!"}),"error"===x&&(0,r.jsx)("p",{className:"text-red-600",children:"Transaction failed. Please try again."})]}),(0,r.jsx)("button",{onClick:E,disabled:"complete"!==b||"signing"===x||"pending"===x,className:"w-full bg-green-600 hover:bg-green-700 disabled:bg-gray-400 text-white font-medium py-3 px-4 rounded-lg transition",children:"signing"===x?"Signing...":"pending"===x?"Transaction Pending...":"Sign & Send Transaction"})]})})})}},1933:function(e,t,n){"use strict";n.d(t,{BB:function(){return c},ES:function(){return u},Lg:function(){return d},nH:function(){return s},sb:function(){return l},screenAddress:function(){return i}});var r=n(257),a=n(6434).Buffer;function o(e){return({ethereum:r.env.NEXT_PUBLIC_ETHEREUM_RPC||"",polygon:r.env.NEXT_PUBLIC_POLYGON_RPC||"",arbitrum:r.env.NEXT_PUBLIC_ARBITRUM_RPC||"",optimism:r.env.NEXT_PUBLIC_OPTIMISM_RPC||""})[e]||""}async function i(e){let{screenAddress:t}=await n.e(961).then(n.bind(n,3961));return t(e)}async function s(e){return{proofData:"0x".concat(a.from(JSON.stringify(e)).toString("hex")),publicSignals:[e.assetSymbol,e.amount,e.senderAddress,e.nonce]}}async function l(e,t,r){let a=o(e);if(!a)throw Error("No RPC URL configured for ".concat(e));let{EvmAdapter:i}=await Promise.all([n.e(21),n.e(866)]).then(n.bind(n,4889)),s=new i;return await s.init({rpcUrl:a}),s.getBalance(t,r)}async function c(e){let t=o(e.network);if(!t)throw Error("No RPC URL configured for ".concat(e.network));let{EvmAdapter:r}=await Promise.all([n.e(21),n.e(866)]).then(n.bind(n,4889)),a=new r;return await a.init({rpcUrl:t}),a.deposit({assetSymbol:e.assetSymbol,amount:e.amount,address:e.address,proof:e.proof})}async function u(e){let t=o(e.network);if(!t)throw Error("No RPC URL configured for ".concat(e.network));let{EvmAdapter:r}=await Promise.all([n.e(21),n.e(866)]).then(n.bind(n,4889)),a=new r;return await a.init({rpcUrl:t}),a.withdraw({assetSymbol:e.assetSymbol,amount:e.amount,address:e.address,proof:e.proof,disclosure:e.disclosure})}async function d(e){let t;let{sendTransaction:r}=await n.e(12).then(n.bind(n,1012));if(e.value){let n=BigInt(e.value);t="0x".concat(n.toString(16))}return await r({to:e.to,data:e.data,value:t})}},5765:function(e,t,n){"use strict";n.d(t,{At:function(){return u},Mi:function(){return s},NO:function(){return m},UK:function(){return o},YX:function(){return c},getAnonymitySetCount:function(){return d},listTxHistory:function(){return f},yJ:function(){return i},ze:function(){return l}});var r=n(6434).Buffer;function a(e){return r.from(e).toString("hex")}function o(e){let t=new Date().toISOString(),n=Math.random().toString(36).slice(2)+Math.random().toString(36).slice(2),r="0x".concat(a("".concat(e.asset,":").concat(e.denomination,":").concat(n,":n"))),o="0x".concat(a("".concat(e.asset,":").concat(e.denomination,":").concat(n,":s"))),i=a("".concat(e.asset,"|").concat(e.denomination,"|").concat(r,"|").concat(o,"|").concat(t)).slice(0,8);return{note:"note-compliant-".concat(e.asset,"-").concat(e.denomination,"-").concat(n,"-").concat(i),asset:e.asset,denomination:e.denomination,nullifier:r,secret:o,checksum:i,createdAt:t}}function i(e){if(!e.startsWith("note-compliant-"))return!1;let t=e.split("-");if(t.length<6)return!1;let n=t[t.length-1];return!!/^[0-9a-fA-F]{8}$/.test(n)&&"string"==typeof a(t.slice(0,t.length-1).join("-")).slice(0,2)}function s(e){if(!i(e))return null;let t=e.split("-");return{asset:t[2]||"",denomination:t[3]||"",checksum:t[t.length-1]}}function l(e){let t="compliant-note-vault",n=localStorage.getItem(t),r=n?JSON.parse(n):[];r.push(e),localStorage.setItem(t,JSON.stringify(r))}function c(){let e=localStorage.getItem("compliant-note-vault");return e?JSON.parse(e):[]}function u(e){try{return!!c().find(t=>t.note===e)}catch(e){return!1}}function d(e,t){try{return c().filter(n=>n.asset===e&&n.denomination===t).length}catch(e){return 0}}function m(e){let t="compliant-tx-history",n=localStorage.getItem(t),r=n?JSON.parse(n):[];r.unshift(e),localStorage.setItem(t,JSON.stringify(r.slice(0,100)))}function f(){let e=localStorage.getItem("compliant-tx-history");return e?JSON.parse(e):[]}},1676:function(e,t,n){"use strict";function r(e){return e?/^0x[a-fA-F0-9]{40}$/.test(e)?{isValid:!0}:{isValid:!1,error:"Invalid Ethereum address format"}:{isValid:!1,error:"Address is required"}}function a(e){if(!e)return{isValid:!1,error:"Amount is required"};let t=parseFloat(e);return isNaN(t)?{isValid:!1,error:"Amount must be a number"}:t<=0?{isValid:!1,error:"Amount must be greater than zero"}:{isValid:!0}}function o(e,t){return e?(({ethereum:["ETH","USDC","USDT"],polygon:["MATIC","USDC","USDT"],arbitrum:["ETH","USDC","USDT"],optimism:["ETH","USDC","USDT"]})[t]||[]).includes(e)?{isValid:!0}:{isValid:!1,error:"Asset ".concat(e," not supported on ").concat(t)}:{isValid:!1,error:"Asset is required"}}n.d(t,{ax:function(){return o},hz:function(){return a},validateAddress:function(){return r}})},1012:function(e,t,n){"use strict";async function r(){if(!window.ethereum)throw Error("No wallet extension found. Please install MetaMask.");try{let e=await window.ethereum.request({method:"eth_requestAccounts"});if(!e||0===e.length)throw Error("No accounts found");let t=e[0],n=await window.ethereum.request({method:"eth_chainId"}),r=parseInt(n,16);return{address:t,chainId:r,isConnected:!0}}catch(e){throw console.error("Wallet connection error:",e),e}}async function a(){if(!window.ethereum)return{address:null,chainId:null,isConnected:!1};try{let e=await window.ethereum.request({method:"eth_accounts"});if(!e||0===e.length)return{address:null,chainId:null,isConnected:!1};let t=e[0],n=await window.ethereum.request({method:"eth_chainId"}),r=parseInt(n,16);return{address:t,chainId:r,isConnected:!0}}catch(e){return console.error("Get wallet state error:",e),{address:null,chainId:null,isConnected:!1}}}async function o(e){if(!window.ethereum)throw Error("No wallet extension found");let t=await window.ethereum.request({method:"eth_accounts"});if(!t||0===t.length)throw Error("No wallet connected");try{let n={from:t[0],to:e.to};return e.value&&(n.value=e.value),e.data&&(n.data=e.data),e.gas&&(n.gas=e.gas),e.gasPrice&&(n.gasPrice=e.gasPrice),await window.ethereum.request({method:"eth_sendTransaction",params:[n]})}catch(e){var n;if(4001===e.code||(null===(n=e.message)||void 0===n?void 0:n.includes("User denied")))throw Error("Transaction rejected by user");throw e}}async function i(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:6e4;if(!window.ethereum)throw Error("No wallet extension found");let n=Date.now();for(;Date.now()-n<t;)try{let t=await window.ethereum.request({method:"eth_getTransactionReceipt",params:[e]});if(t)return t;await new Promise(e=>setTimeout(e,2e3))}catch(e){console.error("Error polling for receipt:",e),await new Promise(e=>setTimeout(e,2e3))}throw Error("Transaction receipt timeout")}n.d(t,{connectWallet:function(){return r},ec:function(){return i},sendTransaction:function(){return o},tC:function(){return a}})},9376:function(e,t,n){"use strict";var r=n(5475);n.o(r,"useRouter")&&n.d(t,{useRouter:function(){return r.useRouter}})},257:function(e,t,n){"use strict";var r,a;e.exports=(null==(r=n.g.process)?void 0:r.env)&&"object"==typeof(null==(a=n.g.process)?void 0:a.env)?n.g.process:n(4227)},4227:function(e){!function(){var t={229:function(e){var t,n,r,a=e.exports={};function o(){throw Error("setTimeout has not been defined")}function i(){throw Error("clearTimeout has not been defined")}function s(e){if(t===setTimeout)return setTimeout(e,0);if((t===o||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(n){try{return t.call(null,e,0)}catch(n){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:o}catch(e){t=o}try{n="function"==typeof clearTimeout?clearTimeout:i}catch(e){n=i}}();var l=[],c=!1,u=-1;function d(){c&&r&&(c=!1,r.length?l=r.concat(l):u=-1,l.length&&m())}function m(){if(!c){var e=s(d);c=!0;for(var t=l.length;t;){for(r=l,l=[];++u<t;)r&&r[u].run();u=-1,t=l.length}r=null,c=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===i||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function f(e,t){this.fun=e,this.array=t}function g(){}a.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];l.push(new f(e,t)),1!==l.length||c||s(m)},f.prototype.run=function(){this.fun.apply(null,this.array)},a.title="browser",a.browser=!0,a.env={},a.argv=[],a.version="",a.versions={},a.on=g,a.addListener=g,a.once=g,a.off=g,a.removeListener=g,a.removeAllListeners=g,a.emit=g,a.prependListener=g,a.prependOnceListener=g,a.listeners=function(e){return[]},a.binding=function(e){throw Error("process.binding is not supported")},a.cwd=function(){return"/"},a.chdir=function(e){throw Error("process.chdir is not supported")},a.umask=function(){return 0}}},n={};function r(e){var a=n[e];if(void 0!==a)return a.exports;var o=n[e]={exports:{}},i=!0;try{t[e](o,o.exports,r),i=!1}finally{i&&delete n[e]}return o.exports}r.ab="//";var a=r(229);e.exports=a}()}},function(e){e.O(0,[434,971,117,744],function(){return e(e.s=2290)}),_N_E=e.O()}]);