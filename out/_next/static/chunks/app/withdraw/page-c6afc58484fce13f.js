(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[549,12,676,933],{6900:function(e,t,r){Promise.resolve().then(r.bind(r,7130))},1933:function(e,t,r){"use strict";r.d(t,{BB:function(){return c},ES:function(){return u},Lg:function(){return d},nH:function(){return i},sb:function(){return l},screenAddress:function(){return s}});var n=r(257),o=r(6434).Buffer;function a(e){return({ethereum:n.env.NEXT_PUBLIC_ETHEREUM_RPC||"",polygon:n.env.NEXT_PUBLIC_POLYGON_RPC||"",arbitrum:n.env.NEXT_PUBLIC_ARBITRUM_RPC||"",optimism:n.env.NEXT_PUBLIC_OPTIMISM_RPC||""})[e]||""}async function s(e){let{screenAddress:t}=await r.e(961).then(r.bind(r,3961));return t(e)}async function i(e){return{proofData:"0x".concat(o.from(JSON.stringify(e)).toString("hex")),publicSignals:[e.assetSymbol,e.amount,e.senderAddress,e.nonce]}}async function l(e,t,n){let o=a(e);if(!o)throw Error("No RPC URL configured for ".concat(e));let{EvmAdapter:s}=await Promise.all([r.e(21),r.e(866)]).then(r.bind(r,4889)),i=new s;return await i.init({rpcUrl:o}),i.getBalance(t,n)}async function c(e){let t=a(e.network);if(!t)throw Error("No RPC URL configured for ".concat(e.network));let{EvmAdapter:n}=await Promise.all([r.e(21),r.e(866)]).then(r.bind(r,4889)),o=new n;return await o.init({rpcUrl:t}),o.deposit({assetSymbol:e.assetSymbol,amount:e.amount,address:e.address,proof:e.proof})}async function u(e){let t=a(e.network);if(!t)throw Error("No RPC URL configured for ".concat(e.network));let{EvmAdapter:n}=await Promise.all([r.e(21),r.e(866)]).then(r.bind(r,4889)),o=new n;return await o.init({rpcUrl:t}),o.withdraw({assetSymbol:e.assetSymbol,amount:e.amount,address:e.address,proof:e.proof,disclosure:e.disclosure})}async function d(e){let t;let{sendTransaction:n}=await r.e(12).then(r.bind(r,1012));if(e.value){let r=BigInt(e.value);t="0x".concat(r.toString(16))}return await n({to:e.to,data:e.data,value:t})}},5762:function(e,t,r){"use strict";r.d(t,{Ai:function(){return a},gW:function(){return i},t4:function(){return o},vS:function(){return s}});var n=r(6434).Buffer;function o(e){var t;let r=new Date().toISOString(),o="bundle-".concat(Date.now(),"-").concat(Math.random().toString(36).substr(2,9)),a=JSON.stringify({type:e.type,amount:e.amount,assetSymbol:e.assetSymbol,senderAddress:e.senderAddress,recipientAddress:e.recipientAddress,proof:e.proof,timestamp:r}),s=n.from(a).toString("hex").slice(0,64).padEnd(64,"0"),i=(null===(t=e.disclosureOptions)||void 0===t?void 0:t.scope)||["amount","assetSymbol","timestamp","withdraw"===e.type?"recipientAddress":null].filter(Boolean);return{id:o,hash:"0x".concat(s),type:e.type,amount:e.amount,assetSymbol:e.assetSymbol,senderAddress:e.senderAddress,recipientAddress:e.recipientAddress,proof:e.proof,proofInput:e.proofInput,timestamp:r,scope:i}}function a(e){try{let t=s();t.push(e),localStorage.setItem("disclosureBundles",JSON.stringify(t))}catch(e){console.error("Error storing disclosure bundle:",e)}}function s(){try{let e=localStorage.getItem("disclosureBundles");if(!e)return[];return JSON.parse(e)}catch(e){return console.error("Error retrieving disclosure bundles:",e),[]}}function i(e){let t=JSON.stringify({type:e.type,amount:e.amount,assetSymbol:e.assetSymbol,senderAddress:e.senderAddress,recipientAddress:e.recipientAddress,proof:e.proof,timestamp:e.timestamp});return"0x".concat(n.from(t).toString("hex").slice(0,64))===e.hash}},5765:function(e,t,r){"use strict";r.d(t,{At:function(){return u},Mi:function(){return i},NO:function(){return m},UK:function(){return a},YX:function(){return c},getAnonymitySetCount:function(){return d},listTxHistory:function(){return f},yJ:function(){return s},ze:function(){return l}});var n=r(6434).Buffer;function o(e){return n.from(e).toString("hex")}function a(e){let t=new Date().toISOString(),r=Math.random().toString(36).slice(2)+Math.random().toString(36).slice(2),n="0x".concat(o("".concat(e.asset,":").concat(e.denomination,":").concat(r,":n"))),a="0x".concat(o("".concat(e.asset,":").concat(e.denomination,":").concat(r,":s"))),s=o("".concat(e.asset,"|").concat(e.denomination,"|").concat(n,"|").concat(a,"|").concat(t)).slice(0,8);return{note:"note-compliant-".concat(e.asset,"-").concat(e.denomination,"-").concat(r,"-").concat(s),asset:e.asset,denomination:e.denomination,nullifier:n,secret:a,checksum:s,createdAt:t}}function s(e){if(!e.startsWith("note-compliant-"))return!1;let t=e.split("-");if(t.length<6)return!1;let r=t[t.length-1];return!!/^[0-9a-fA-F]{8}$/.test(r)&&"string"==typeof o(t.slice(0,t.length-1).join("-")).slice(0,2)}function i(e){if(!s(e))return null;let t=e.split("-");return{asset:t[2]||"",denomination:t[3]||"",checksum:t[t.length-1]}}function l(e){let t="compliant-note-vault",r=localStorage.getItem(t),n=r?JSON.parse(r):[];n.push(e),localStorage.setItem(t,JSON.stringify(n))}function c(){let e=localStorage.getItem("compliant-note-vault");return e?JSON.parse(e):[]}function u(e){try{return!!c().find(t=>t.note===e)}catch(e){return!1}}function d(e,t){try{return c().filter(r=>r.asset===e&&r.denomination===t).length}catch(e){return 0}}function m(e){let t="compliant-tx-history",r=localStorage.getItem(t),n=r?JSON.parse(r):[];n.unshift(e),localStorage.setItem(t,JSON.stringify(n.slice(0,100)))}function f(){let e=localStorage.getItem("compliant-tx-history");return e?JSON.parse(e):[]}},695:function(e,t,r){"use strict";function n(){try{let e=localStorage.getItem("allowlistedRelayers");if(!e)return o();return JSON.parse(e)}catch(e){return console.error("Error retrieving relayers:",e),o()}}function o(){return[{id:"1",name:"Relayer Alpha",address:"0x742d35Cc6634C0532925a3b844Bc9e7595f0bEb",fee:"1000000000000000",feeFormatted:"0.001 ETH",sla:"99.9%",riskBadge:"Low Risk",status:"Active",network:"ethereum",ttlSeconds:300},{id:"2",name:"Relayer Beta",address:"0x8ba1f109551bD432803012645Hac136c22C9299",fee:"800000000000000",feeFormatted:"0.0008 ETH",sla:"99.5%",riskBadge:"Low Risk",status:"Active",network:"ethereum",ttlSeconds:300}]}async function a(e,t,r){let o=n().find(r=>r.id===e&&r.network===t);if(!o||"Active"!==o.status)return null;let a=BigInt(r)*BigInt(1)/BigInt(1e3),s=BigInt(o.fee);return{relayerId:o.id,fee:(a>s?a:s).toString(),ttlSeconds:o.ttlSeconds}}function s(e){return n().filter(t=>t.network===e&&"Active"===t.status)}r.d(t,{SM:function(){return s},v8:function(){return a}})},1676:function(e,t,r){"use strict";function n(e){return e?/^0x[a-fA-F0-9]{40}$/.test(e)?{isValid:!0}:{isValid:!1,error:"Invalid Ethereum address format"}:{isValid:!1,error:"Address is required"}}function o(e){if(!e)return{isValid:!1,error:"Amount is required"};let t=parseFloat(e);return isNaN(t)?{isValid:!1,error:"Amount must be a number"}:t<=0?{isValid:!1,error:"Amount must be greater than zero"}:{isValid:!0}}function a(e,t){return e?(({ethereum:["ETH","USDC","USDT"],polygon:["MATIC","USDC","USDT"],arbitrum:["ETH","USDC","USDT"],optimism:["ETH","USDC","USDT"]})[t]||[]).includes(e)?{isValid:!0}:{isValid:!1,error:"Asset ".concat(e," not supported on ").concat(t)}:{isValid:!1,error:"Asset is required"}}r.d(t,{ax:function(){return a},hz:function(){return o},validateAddress:function(){return n}})},1012:function(e,t,r){"use strict";async function n(){if(!window.ethereum)throw Error("No wallet extension found. Please install MetaMask.");try{let e=await window.ethereum.request({method:"eth_requestAccounts"});if(!e||0===e.length)throw Error("No accounts found");let t=e[0],r=await window.ethereum.request({method:"eth_chainId"}),n=parseInt(r,16);return{address:t,chainId:n,isConnected:!0}}catch(e){throw console.error("Wallet connection error:",e),e}}async function o(){if(!window.ethereum)return{address:null,chainId:null,isConnected:!1};try{let e=await window.ethereum.request({method:"eth_accounts"});if(!e||0===e.length)return{address:null,chainId:null,isConnected:!1};let t=e[0],r=await window.ethereum.request({method:"eth_chainId"}),n=parseInt(r,16);return{address:t,chainId:n,isConnected:!0}}catch(e){return console.error("Get wallet state error:",e),{address:null,chainId:null,isConnected:!1}}}async function a(e){if(!window.ethereum)throw Error("No wallet extension found");let t=await window.ethereum.request({method:"eth_accounts"});if(!t||0===t.length)throw Error("No wallet connected");try{let r={from:t[0],to:e.to};return e.value&&(r.value=e.value),e.data&&(r.data=e.data),e.gas&&(r.gas=e.gas),e.gasPrice&&(r.gasPrice=e.gasPrice),await window.ethereum.request({method:"eth_sendTransaction",params:[r]})}catch(e){var r;if(4001===e.code||(null===(r=e.message)||void 0===r?void 0:r.includes("User denied")))throw Error("Transaction rejected by user");throw e}}async function s(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:6e4;if(!window.ethereum)throw Error("No wallet extension found");let r=Date.now();for(;Date.now()-r<t;)try{let t=await window.ethereum.request({method:"eth_getTransactionReceipt",params:[e]});if(t)return t;await new Promise(e=>setTimeout(e,2e3))}catch(e){console.error("Error polling for receipt:",e),await new Promise(e=>setTimeout(e,2e3))}throw Error("Transaction receipt timeout")}r.d(t,{connectWallet:function(){return n},ec:function(){return s},sendTransaction:function(){return a},tC:function(){return o}})},7130:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return f}});var n=r(7437),o=r(2265),a=r(9376),s=r(1676),i=r(1933),l=r(1012),c=r(5762),u=r(5765),d=r(695),m=r(257);function f(){let[e,t]=(0,o.useState)(""),[r,f]=(0,o.useState)(""),[h,g]=(0,o.useState)("ethereum"),[p,b]=(0,o.useState)(!1),[y,w]=(0,o.useState)("idle"),[x,v]=(0,o.useState)("idle"),[S,N]=(0,o.useState)(null),[k,T]=(0,o.useState)(""),[A,j]=(0,o.useState)([]),[E,I]=(0,o.useState)([]),[C,P]=(0,o.useState)(null),[O,_]=(0,o.useState)(null),[R,B]=(0,o.useState)(!1),D=(0,a.useRouter)();(0,o.useEffect)(()=>{try{let e=(0,u.YX)();j(e.map(e=>e.note))}catch(e){}},[]),(0,o.useEffect)(()=>{(async()=>{try{var e;let t=(0,d.SM)(h);I(t),P((null===(e=t[0])||void 0===e?void 0:e.id)||null)}catch(e){I([]),P(null)}})()},[h]);let U=async()=>{if(e&&r)try{var t,n;let o=(0,s.validateAddress)(e);if(!o.isValid){alert(o.error);return}let a=(0,s.hz)(r);if(!a.isValid){alert(a.error);return}if(k){if(!(0,u.yJ)(k)){alert("Invalid note format");return}if(!(0,u.At)(k)&&!confirm("Note not found in local vault. Continue anyway?"))return;let e=(0,u.Mi)(k);(null==e?void 0:e.denomination)&&!r&&f(e.denomination)}w("generating");let c=await (0,l.tC)();if(!c.address){alert("Please connect your wallet first"),w("idle");return}let d={assetSymbol:(null===(t=(0,u.Mi)(k))||void 0===t?void 0:t.asset)||"ETH",amount:r||(null===(n=(0,u.Mi)(k))||void 0===n?void 0:n.denomination)||"",senderAddress:c.address,nonce:Date.now().toString()},m=await (0,i.nH)(d);sessionStorage.setItem("lastWithdrawProof",JSON.stringify(m)),sessionStorage.setItem("lastWithdrawProofInput",JSON.stringify(d)),w("complete")}catch(e){console.error("Proof generation error:",e),alert("Failed to generate proof"),w("idle")}},J=async()=>{if(C&&r){B(!0),_(null);try{let e=await (0,d.v8)(C,h,r);e&&_("".concat(e.fee," wei (ttl ").concat(e.ttlSeconds,"s)"))}catch(e){console.error(e),alert("Failed to get relayer quote")}finally{B(!1)}}},L=async()=>{if("complete"===y)try{let t;if(!(await (0,l.tC)()).address){alert("Please connect your wallet first");return}let n=sessionStorage.getItem("lastWithdrawProof");if(!n){alert("Proof not found. Please generate proof first.");return}let o=JSON.parse(n),a=sessionStorage.getItem("lastWithdrawProofInput");if(p&&a){let n=JSON.parse(a),s=(0,c.t4)({type:"withdraw",amount:r,assetSymbol:n.assetSymbol,senderAddress:n.senderAddress,recipientAddress:e,proof:o,proofInput:n,disclosureOptions:{enableSelectiveDisclosure:!0,scope:["amount","assetSymbol","recipientAddress","timestamp"]}});(0,c.Ai)(s),t=s.hash}let s=await (0,i.ES)({network:h,assetSymbol:"ETH",amount:r,address:e,proof:o,disclosure:p?{enableSelectiveDisclosure:!0,scope:["amount","assetSymbol","recipientAddress","timestamp"],disclosureHash:t}:void 0}),d=m.env.NEXT_PUBLIC_CONTRACT_ADDRESS||"0x0000000000000000000000000000000000000000";if(!s||"0x"===s){alert("Transaction calldata not available. Contract may not be deployed.");return}v("signing");let f=await (0,i.Lg)({network:h,to:d,data:s});N(f),v("pending");try{await (0,l.ec)(f,12e4),v("success"),(0,u.NO)({type:"withdraw",asset:"ETH",amount:r,network:h,address:e,hash:f,timestamp:new Date().toISOString()}),setTimeout(()=>{D.push("/dashboard")},2e3)}catch(e){v("pending")}}catch(e){console.error("Submit error:",e),alert("Failed to prepare transaction: ".concat(e instanceof Error?e.message:"Unknown error"))}};return(0,n.jsx)("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 py-12",children:(0,n.jsx)("div",{className:"max-w-2xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,n.jsxs)("div",{className:"bg-white dark:bg-gray-800 shadow rounded-lg p-8",children:[(0,n.jsx)("h1",{className:"text-3xl font-bold mb-6",children:"Withdraw"}),(0,n.jsxs)("div",{className:"mb-6",children:[(0,n.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Network"}),(0,n.jsx)("div",{className:"grid grid-cols-2 gap-3",children:[{id:"ethereum",name:"Ethereum",chainId:1},{id:"polygon",name:"Polygon",chainId:137},{id:"arbitrum",name:"Arbitrum",chainId:42161},{id:"optimism",name:"Optimism",chainId:10}].map(e=>(0,n.jsx)("button",{onClick:()=>g(e.id),className:"px-4 py-3 rounded-lg border transition ".concat(h===e.id?"border-blue-600 bg-blue-50 dark:bg-blue-900/20":"border-gray-300 dark:border-gray-600 hover:border-gray-400"),children:e.name},e.id))})]}),(0,n.jsxs)("div",{className:"mb-6",children:[(0,n.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Deposit Note (optional)"}),(0,n.jsx)("input",{type:"text",value:k,onChange:e=>T(e.target.value),placeholder:"note-compliant-...",className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white"}),A.length>0&&(0,n.jsxs)("div",{className:"text-xs text-gray-500 mt-2",children:["From vault:",(0,n.jsx)("div",{className:"mt-1 space-x-2 overflow-x-auto whitespace-nowrap",children:A.slice(0,3).map((e,t)=>(0,n.jsxs)("button",{onClick:()=>T(e),className:"underline",children:["note #",t+1]},t))})]})]}),(0,n.jsxs)("div",{className:"mb-6",children:[(0,n.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Destination Address"}),(0,n.jsx)("input",{type:"text",value:e,onChange:e=>t(e.target.value),placeholder:"0x...",className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white"})]}),(0,n.jsxs)("div",{className:"mb-6",children:[(0,n.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Amount"}),(0,n.jsx)("input",{type:"text",value:r,onChange:e=>f(e.target.value),placeholder:"0.0",className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white"})]}),(0,n.jsxs)("div",{className:"mb-6",children:[(0,n.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Relayer (optional)"}),(0,n.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,n.jsx)("select",{value:C||"",onChange:e=>P(e.target.value),className:"px-3 py-2 border rounded-lg bg-white dark:bg-gray-700",children:E.map(e=>(0,n.jsx)("option",{value:e.id,children:e.name},e.id))}),(0,n.jsx)("button",{onClick:J,disabled:!C||!r||R,className:"px-3 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg",children:R?"Quoting...":"Get Quote"}),O&&(0,n.jsx)("span",{className:"text-sm text-gray-600 dark:text-gray-300",children:O})]})]}),(0,n.jsxs)("div",{className:"mb-6",children:[(0,n.jsxs)("label",{className:"flex items-center space-x-2",children:[(0,n.jsx)("input",{type:"checkbox",checked:p,onChange:e=>b(e.target.checked),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),(0,n.jsx)("span",{className:"text-sm font-medium",children:"Enable Selective Disclosure"})]}),(0,n.jsx)("p",{className:"text-sm text-gray-500 mt-1 ml-6",children:"Allow auditors to view transaction details for compliance"})]}),(0,n.jsxs)("div",{className:"mb-6",children:[(0,n.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,n.jsx)("label",{className:"block text-sm font-medium",children:"ZK Proof Generation"}),"complete"===y&&(0,n.jsx)("span",{className:"text-green-600 text-sm",children:"✓ Complete"}),"generating"===y&&(0,n.jsx)("span",{className:"text-blue-600 text-sm",children:"Generating..."})]}),(0,n.jsx)("button",{onClick:U,disabled:!e||!r||"generating"===y||"complete"===y,className:"w-full bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white font-medium py-2 px-4 rounded-lg transition",children:"Generate Proof"})]}),"idle"!==x&&(0,n.jsxs)("div",{className:"mb-6 p-4 rounded-lg bg-gray-50 dark:bg-gray-700",children:["signing"===x&&(0,n.jsx)("p",{className:"text-blue-600",children:"Please sign the transaction in your wallet..."}),"pending"===x&&(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"text-yellow-600 mb-2",children:"Transaction submitted. Waiting for confirmation..."}),S&&(0,n.jsxs)("p",{className:"text-sm text-gray-600 dark:text-gray-400 break-all",children:["Hash: ",S]})]}),"success"===x&&(0,n.jsx)("p",{className:"text-green-600",children:"✓ Transaction confirmed!"}),"error"===x&&(0,n.jsx)("p",{className:"text-red-600",children:"Transaction failed. Please try again."})]}),(0,n.jsx)("button",{onClick:L,disabled:"complete"!==y||"signing"===x||"pending"===x,className:"w-full bg-green-600 hover:bg-green-700 disabled:bg-gray-400 text-white font-medium py-3 px-4 rounded-lg transition",children:"signing"===x?"Signing...":"pending"===x?"Transaction Pending...":"Sign & Send Transaction"})]})})})}},9376:function(e,t,r){"use strict";var n=r(5475);r.o(n,"useRouter")&&r.d(t,{useRouter:function(){return n.useRouter}})},257:function(e,t,r){"use strict";var n,o;e.exports=(null==(n=r.g.process)?void 0:n.env)&&"object"==typeof(null==(o=r.g.process)?void 0:o.env)?r.g.process:r(4227)},4227:function(e){!function(){var t={229:function(e){var t,r,n,o=e.exports={};function a(){throw Error("setTimeout has not been defined")}function s(){throw Error("clearTimeout has not been defined")}function i(e){if(t===setTimeout)return setTimeout(e,0);if((t===a||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(r){try{return t.call(null,e,0)}catch(r){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:a}catch(e){t=a}try{r="function"==typeof clearTimeout?clearTimeout:s}catch(e){r=s}}();var l=[],c=!1,u=-1;function d(){c&&n&&(c=!1,n.length?l=n.concat(l):u=-1,l.length&&m())}function m(){if(!c){var e=i(d);c=!0;for(var t=l.length;t;){for(n=l,l=[];++u<t;)n&&n[u].run();u=-1,t=l.length}n=null,c=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===s||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function f(e,t){this.fun=e,this.array=t}function h(){}o.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];l.push(new f(e,t)),1!==l.length||c||i(m)},f.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=h,o.addListener=h,o.once=h,o.off=h,o.removeListener=h,o.removeAllListeners=h,o.emit=h,o.prependListener=h,o.prependOnceListener=h,o.listeners=function(e){return[]},o.binding=function(e){throw Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(e){throw Error("process.chdir is not supported")},o.umask=function(){return 0}}},r={};function n(e){var o=r[e];if(void 0!==o)return o.exports;var a=r[e]={exports:{}},s=!0;try{t[e](a,a.exports,n),s=!1}finally{s&&delete r[e]}return a.exports}n.ab="//";var o=n(229);e.exports=o}()}},function(e){e.O(0,[434,971,117,744],function(){return e(e.s=6900)}),_N_E=e.O()}]);